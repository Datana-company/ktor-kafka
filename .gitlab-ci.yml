image: adoptopenjdk/openjdk11:alpine-slim

stages:
#    - build
    - test
    - deploy

before_script:
    #  - echo `pwd` # debug
    - echo "$CI_BUILD_NAME, $CI_BUILD_REF_NAME $CI_BUILD_STAGE" # debug
    - export GRADLE_USER_HOME=`pwd`/.gradle

cache:
    paths:
        - .gradle/wrapper
        - .gradle/caches

#build:
#    stage: build
#    script:
#        - ./gradlew build
#    only:
#        - master

test:
     stage: test
     script:
         - ./gradlew check
     only:
         - feature/*

deploy:
    stage: deploy
    script:
        - ./gradlew deploy
    only:
        - dev
        - master

after_script:
    - echo "End CI"
